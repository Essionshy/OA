<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuhong.oa.mapper.CustomUserMapper">
	<sql id="User_Where_Clause">
		
			<if test="userName != null and userName !=''">
				and user_name=#{userName}
			</if>
			<if test="positionId != null and positionId != ''">
				and p.code=#{positionId}
			</if>	
			<if test="deptId != null and deptId != ''">
				and d.dept_id=#{deptId}
			</if>			
			<if test="state != null">
				and u.state=#{state}
			</if>
			<if test="startDate != null and  endDate !=null ">
				and u.gmt_create between #{startDate} and #{endDate}
			</if>		
	</sql>
	
	<select id="listUserByCondition"
		parameterType="CustomUserDO"
		resultType="CustomUserDO">
		SELECT
		user_name,
		e.name real_name,
		d.name dept_name,
		p.name postion_name,
		u.state,
		u.gmt_create,
		u.remark
		FROM oa_sys_user u LEFT JOIN oa_emp_basic e ON
		user_name=e.emp_id
		LEFT JOIN oa_sys_department d ON
		d.`dept_id`=e.`dept_id` LEFT JOIN
		oa_sys_position p ON
		p.`code`=e.`position_code`
		<where>
			<include refid="User_Where_Clause"></include>			
		</where>
		<if test="startPage != null and pageSize !=null">
			limit #{startPage},#{pageSize}
		</if>
	</select>
	<select id="getUserTotalCount" parameterType="CustomUserDO"
		resultType="long">
		SELECT
		count(*)
		FROM oa_sys_user u LEFT JOIN oa_emp_basic e ON
		user_name=e.emp_id
		LEFT JOIN oa_sys_department d ON
		d.`dept_id`=e.`dept_id` LEFT JOIN
		oa_sys_position p ON
		p.`code`=e.`position_code`
		<where>
			<include refid="User_Where_Clause"></include>			
		</where>
	</select>
</mapper>